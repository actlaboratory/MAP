		Mail Authorization Proxy -MAP-

	バージョン:　　ver.0.1.0
	リリース:　　　2022-05-29
	開発・配布元:　ACT Laboratory　(https://actlab.org/)
	主要開発者:　　吹雪
　　ソフト種別:　　オープンソースソフトウェア　(GitHubリポジトリ:https://github.com/actlaboratory/MAP/)
　　ライセンス:　　MIT License

第１章　はじめに
１．１　Mail Authorization Proxy(MAP)の概要
Mail Authorization Proxy(MAP)は、従来のパスワードによる認証のみに対応したメールクライアントであっても、新しいOAuth認証が必須とされているメールサーバとの通信を可能とするソフトウェアです。
現在は、Google社が提供するGmail(GSuite・Google Workspaceで利用する場合を含む)のみに対応しています。

仕組みを簡単に説明すると、次のようになります。
まず、本ソフトウェアが、メールサーバのふりをして、お使いのメールクライアントからの通信を受け付けます。
本ソフトウェアは、パスワード認証の部分以外は、受け取った通信内容をそのままメールサーバに渡します。
逆に、メールサーバからの通信内容も、ほぼそのままメールクライアントに渡します。これで、
丁度、郵便屋さんに手紙を預けると、そのまま配達してくれるのと同じようなものです。
そして、パスワード認証の部分の通信では、メールクライアントから受け取ったパスワードを無視して、代わりに新しい方式での認証情報を送ります。
ここだけは、そのまま送ってしまうとメールサーバのご機嫌を損ねてしまうので、こっそりいい感じに内容を書き換えます。
専門的に言うと、ローカルマシン上でPOP/SMTP専用のプロキシサーバとしてふるまいながら、認証情報だけを書き換えます。

１．２　動作環境について
64ビット版Windows10で動作確認を行っています。
多くの場合、Windowsの他のバージョンでも動作すると思われます。

本ソフトウェアは、POP3とSMTPのみに対応しています。IMAPに対応していない点には特に注意してください。


第２章　セットアップ
２．１　インストール
MAPを使用するに当たって、特別なインストール作業は必要ありません。
ダウンロードしたzipファイルを適当な場所に展開し、「MAP」フォルダ内の「MAP.exe」を実行すると起動することができます。

２．２　アンインストール
MAPをコンピュータから削除する場合は、「MAP」フォルダを削除してください。
その他、特別な作業は不要です。

２．３　アップデート
発見された不具合の修正、新機能の追加、ツイキャスの仕様変更への対応などの目的で、定期的にバージョンアップを行います。
新しいバージョンが利用可能な場合、MAPの起動時にメッセージが表示されます。
指示に従って操作してください。


第３章　基本操作
この章では、MAPに自分のアカウントを登録して、送受信できるようにする操作を解説します。
各メニュー項目や設定項目の詳細については、第４章を参照してください。

３．１　アカウントの登録

MAPを利用するには、アカウントを登録する必要があります。
メニューバーから[ファイル]→[アカウントを追加(&A)]を実行すると、アカウント追加のダイアログが表示されます。
ここで、送受信したいメールアドレスを入力します。「name@example.com」のように、@以降も省略せずに入力する必要があります。
なお、Gmailで最新モードを利用したい場合であっても、ここでは「recent:」を先頭につけずに入力します。
[OK]ボタンを押しても画面が変化しない場合には、入力内容が間違っていますので、全ての文字を半角で入力しているかなど、よく確認してください。

正しく入力したうえで、[OK]ボタンを押すと、ブラウザを開いて認証に進むことができます。
Googleの場合は、最初の画面でメールアドレス、次の画面でパスワードを入力します。既にログインしている場合には、アカウントを選択するように求められる場合もあります。
パスワードのにゅうろy区、もしくはアカウントの選択の後、[このアプリは Google で確認されていません]という画面が表示された場合には、[詳細]ボタンを押します。
[詳細]ボタンを押すと、画面下部に追加の要素が表示されます。
[Mail Authorization Proxy（安全ではないページ）に移動]を押すと、次の画面に進むことができます。

次の画面では、[Mail Authorization Proxy が Google アカウントへのアクセスを求めています]と表示されます。
内容を確認し、[続行]を押してください。

Internet Explorerをお使いの場合には、警告のダイアログが表示される場合がありますが、ここでは[はい]を選択してください。

ここまでの捜査を終えると、認証が完了し、ブラウザを閉じるように求められますので、指示に従ってブラウザを閉じてください。

３．３　メールクライアントを設定する
MAPを通じてメールを送受信するためには、お使いのメールクライアントの設定を下記のように変更する必要があります。

メールＩＤ：従来通り
パスワード：入力されていれば、何でもよい(空欄での動作は未保証です。適当な半角英数文字列を入力してください)
受信(POP)サーバ：localhost　ポート番号：8110　SSL：なし
送信(SMTP)サーバ：localhost　ポート番号：8025　SSL：なし
SMTP認証：使用する

３．３　サーバの起動
最後に、本ソフト内のサーバを起動して、メールクライアントからの接続を受け付けます。
メニューバーの[ファイル]→[起動]を実行してください。

ここで、[Windows ファイアウォール]の警告ウィンドウが表示された場合には、必ず「いいえ」を選択してください。
「はい」を選択すると、あなたのアカウントを用いて他のコンピュータの利用者がメールを送受信できるようになってしまう場合があり、大変危険です。
※万一間違って「はい」を選択してしまった場合、設定を変更するのはとても手間がかかります。Windowsの操作に特に詳しい方以外は、本ソフトウェアを一度終了し、配置場所(ディレクトリ)を変更してから再度起動してください。
※ここで[Windows ファイアウォール]の警告ウィンドウが表示されなかった場合も、同様に大変危険な状況になってしまう場合があります。
　この場合、お使いのPCで過去に起動したソフトウェアや、その設定が影響していると思われます。
　よくわからない場合はすぐに本ソフトウェアを終了し、利用を注視してください。

ここまでの操作を行えば、従来と変わらない手順でメールクライアントが利用できるはずです。
送受信が正常に行えることを確認してください。


第４章　メニューリファレンス
ここでは、MAPの各メニュー項目について解説します。
また、メニューを選択することによって表示される設定画面の内容についても記載しています。

各メニュー項目には、メニューを呼び出さずに該当する項目を実行できるショートカットキーが用意されている場合があります。
ショートカットキーは自由に変更できますが、ここでは初期値として設定されているショートカットキーを、「」で囲んで記載します。

なお、MAPを起動した直後に表示される画面には、メニュー項目の中でも特に使用頻度が高いと思われる項目が表示されています。
機能は、該当するメニュー項目と同じです。

４．１　ファイル
４．１．１　起動 「ctrl+s」
本ソフトウェアのサーバを起動し、メールクライアントからの通信を受け付けます。

４．１．２　停止「ctrl+t」
本ソフトウェアのサーバを停止します。

４．１．３　アカウントを追加
送受信したいアカウントを追加で登録します。
詳しい操作方法は３．１を参照してください。

４．１．４　メインウィンドウを開く
メインウィンドウを開きます。

４．１．５　メインウィンドウを隠す
メインウィンドウを最小化し、タスクトレイに格納します。
なお、サーバが起動中の場合には、Alt+F4を押すなどしてウィンドウを閉じた場合にも、タスクトレイに最小化されます。

４．１．６　終了
MAPを完全に終了します。

４．５　オプション
４．５．１　オプション
MAPの動作に関する様々な設定を行うことができます。
この項目を選択すると、各種設定を行うためのダイアログボックスが表示されます。

このダイアログボックスは、複数のタブ（ページ）で構成されています。
Ctrl+Tab、Ctrl+Shift+Tabを押すと、表示するタブを切り替えることができます。
また、画面上部に表示されているタブをクリックすることで、直接目的のタブを表示させることもできます。

設定を保存してダイアログボックスを閉じるには、[OK]ボタンを押します。
変更を破棄してダイアログボックスを閉じるには、[キャンセル]ボタンを押します。

４．５．１．１　一般
MAPの動作全般に関する設定を行います。

４．３．１．１．１　ログ記録レベル
MAPを起動すると、インストール先フォルダに「map.log」というファイルが作成され、動作のログが記録されます。
この設定を使用して、記録される動作のログの詳細度を設定します。CRITICALやERRORに設定すると、ほとんど記録されません。ログファイルの容量を減らすことができます。
逆に、DEBUGに設定すると、詳細な動作の記録を得ることができます。
ここでの設定は、MAPの再起動後から有効になります。
万一不具合が発生した場合には、DEBUGレベルで動作を記録すると、原因の特定に活用することができます。
ただし、DEBUGレベルのログには、送受信しているメールの宛先や本文を含め、機微な情報が記録されます。
開発者の方や、開発者に情報提供いただけるパワーユーザーの方以外は、変更しないことを推奨します。

４．３．１．１．２　出力先
スクリーンリーダーに直接音声を出力して操作をガイドする場合の出力先を設定します。

４．３．１．１．３　サーバを起動して最小化状態で起動する
この設定をONにすると、本ソフトウェアの起動と同時にサーバを自動起動し、さらにタスクトレイに最小化去れるようになります。
既定では、チェックされていません。
後述するWindows起動時の自動起動と合わせて使用することで、本ソフトウェアの存在を意識することなくメールを使用できるようになります。

４．５．１．２　表示/言語
画面表示に関する設定です。
また、MAPの表示言語を変更することもできます。

４．５．１．２．１　言語
MAPの表示や読み上げに使用する言語を設定します。
ただし、本ソフトウェアはまだ未完成のため、この設定を変更しても、一部の箇所にしか反映されません。
この設定を有効にするには、MAPの再起動が必要です。

４．５．１．２．２　画面表示モード
画面の表示方法を、[標準]、[反転表示]の間で設定します。
規定では[標準]に設定されています。
この設定を有効にするには、MAPの再起動が必要です。

４．５．１．２．３　テキストの折り返し
複数行のエディットボックスで、長い行を折り返して表示するかどうかを設定します。
[画面幅で折り返し]を選択すると、画面幅に合わせて折り返しが行われます。
規定では[折り返さない]に設定されています。
この設定を有効にするには、MAPの再起動が必要です。


４．５．１．３　ネットワーク
本ソフトウェアのアップデートや、外部のサーバと通信する際に、プロキシサーバーを使用する場合に必要な設定を行います。

４．５．１．３．１　起動時に更新を確認
起動時にMAPの更新を確認するかどうかを設定します。
この設定は、規定でチェックされています。

４．５．１．３．２　プロキシサーバーの情報を手動で設定する
プロキシサーバーの情報を手動で設定するかどうかを設定します。
通常、MAPはWindowsに設定されたプロキシサーバーの情報を使用して接続を行いますが、何らかの理由で個別に設定したい場合は、この設定をチェックしてください。
なお、ここで設定しているプロキシサーバは、メールの通信時には使用されません。
アカウント追加の際や、アップデートの取得にのみ影響します。

４．５．１．３．３　サーバーURL
[プロキシサーバーの情報を手動で設定する]が有効な場合に、プロキシサーバーのURLを設定します。

４．５．１．３．４　ポート番号
[プロキシサーバーの情報を手動で設定する]が有効な場合に、プロキシサーバーのポート番号を設定します。

４．５．２　ショートカットキーの設定
よく使う機能にショートカットキーを割り当てたり、すでに設定されている割り当てを変更したりできます。
ここで設定したショートカットキーは、MAPのウインドウが前面に表示されている場合にのみ機能します。
前面に表示されているウインドウに関係なく、MAPの起動中は常に使用できるショートカットキーを設定するには、次節の[グローバルホットキーの設定]を使用します。

[ショートカットキーの設定]ダイアログボックスには、以下の項目があります。
現在の登録内容：ショートカットキーを設定できるコマンドと、現在割り当てられているショートカットキーを表示します。該当する項目にショートカットキーが設定されていない場合は、「なし」と表示されます。
変更：選択した設定を変更します。
OK：設定を保存し、ダイアログボックスを閉じます。
キャンセル：設定を破棄し、ダイアログボックスを閉じます。

ショートカットキーを設定するには、以下の手順で操作します。
１．　[現在の登録内容]から、設定したい項目を選択します。
２．　[変更]ボタンを押します。
３．　[ショートカット1]の[設定]ボタンを押します。
４．　設定したいキーの組み合わせを押します。ショートカットキーの割り当てを削除したい場合は、Escapeキーを押します。
なお、１つのコマンドについて、ショートカットキーを最大５個設定できます。

４．５．３　windows起動時の自動起動を有効化
windowsを起動した際に、本ソフトウェアを自動で起動するように設定することができます。


４．６　ヘルプ
４．６．１　バージョン情報
MAPのバージョン番号を確認できます。

４．６．３　更新を確認
新しいバージョンが利用可能かどうかを確認します。
画面の指示に従って操作してください。


第５章　その他
５．１　利用に当たっての注意事項
１．　MAPのインストール先フォルダにある「.credential」ディレクトリには、設定したアカウント情報が保存されます。この情報が他人に流出すると、アカウントを乗っ取られてしまう可能性があります。取り扱いには十分ご注意ください。
２．　複数のコンピュータからMAPを利用する場合には、いずれかのコンピュータでまとめてアカウント設定を行った後、「data」フォルダ内のaccounts.datをコピーしてください。複数のMAPから同一のアカウントを追加してしまうと、前に追加したコンピュータではアカウントに接続できなくなります。
３．　MAPは、先述のwindowsファイアウォールの設定を誤った場合、「.credential」ディレクトリの内容が流出した場合、同一PCでアカウントを切り替えて利用している場合など、本来のメールのセキュリティを弱めてしまう場合があります。
　　　本来メールプロバイダが提供するセキュリティを弱める行為ですので、リスクを十分に認識したうえでご利用いただき、可能な限り本ソフトが不要な環境を用意できるように努めてください。
４．　本ソフトの利用について、お使いのメールプロバイダやメールクライアントの開発者に問い合わせをすることはご遠慮ください。
　　　先述の通り、サーバ名等に特殊な設定を行う必要があるため、先方を混乱させたり、誤ったサポートを受けてしまったりする場合があります。
５．　Googleの制限により、本ソフトウェアの利用アカウントは合計100に制限されています。
　　　利用者が増えてアカウント数が上限に達した場合、新たなアカウントを登録できなくなる場合があります。
６．　MAPの使用中、以下のようなメッセージが表示されることがあります。
----------
An error has occured. Contact to the developer for further assistance.
----------
このメッセージは、ソフトウェアに何らかの問題が起きていることを表しています。[OK]ボタンを押すと、自動的にMAPは終了します。
この現象が発生した場合、MAPをインストールしたフォルダ内に「errorlog.txt」というファイルが作成されています。
このファイルの内容と、直前に行った操作の内容を、開発者までお知らせください。

５．２　連絡先
このソフトウェアを利用しての感想やご要望、不具合のご報告などは、以下のメールアドレスまたは掲示板へご連絡ください。

ACT Laboratory サポート：support@actlab.org
ACT Laboratory 掲示板：https://actlab.org/bbs/
